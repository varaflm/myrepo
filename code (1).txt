Private Sub Application_ItemSend(ByVal Item As Object, Cancel As Boolean)
    
    

  '-----------------------------****-----------------------------****-----------------------------

  'Warn before the email is being sent for outside the restricted emails

  '-----------------------------****-----------------------------****-----------------------------



    Const PR_SMTP_ADDRESS As String = "http://schemas.microsoft.com/mapi/proptag/0x39FE001E"
    Const INFRAHEDGE_Email As String = "gsmc.infrahedge2@mindtree.com"
    Const GSMCSERVICEDESK_Email As String = "gsmc.servicedesk@mindtree.com"
    Const MACARTHUR_Email As String = "MacArthur.GSMC@mindtree.com"
    Const FORDFOUNDATION_Email As String = "gsmc.fordfoundation@mindtree.com"
    Const GSMCMSCDIRECT_Email As String = "gsmc.mscdirect@mindtree.com"
    Const PSIC_Email As String = "psic.gsmc@mindtree.com"
    Const BISSELL_Email As String = "gsmc.bissell@mindtree.com"
    Const REALOGY_Email As String = "gsmc.realogy@mindtree.com"
    Const HUSQVARNA_Email As String = "husqvarna.gsmc@mindtree.com"
    Const GSMCCAP_Email As String = "gsmc.cap@mindtree.com"
    Const GSMCNORDEX_Email As String = "gsmc.nordex@mindtree.com"
    Const GSMCTCG_Email As String = "gsmc.tcg@mindtree.com"
    Const Gunnebo_Email As String = "gunnebo.gsmc@mindtree.com"
    
    
    
    Dim myfolder As Outlook.folder
    Set myfolder = Application.ActiveExplorer.CurrentFolder
    Dim account As Outlook.account
    Set account = GetAccountForFolder(myfolder)
'---------------------------------------------------------------------------------------------
    Dim emailRecepients As Recipients
    Dim emailRecepient As Recipient
    Dim propAccess As Outlook.PropertyAccessor
    Dim strRecepient As String
    Dim iLen As Integer
    Dim flagWarn As Boolean
    flagWarn = False

     '----------------25-Sep-2019----------------
      Dim stremailBody As String
      Dim responseInt1 As Integer
    '----------------25-Sep-2019----------------

    Set emailRecepients = Item.Recipients
'For each outlook account, restrict the email and warn if it is not sent to listed emails
Select Case LCase(account.SmtpAddress)

'First email account ( gsmc.infrahedge2@mindtree.com )

        Case INFRAHEDGE_Email     'gsmc.infrahedge2@mindtree.com

        'Case "ranganath.vadavi@mindtree.com"
    
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                   

                    'allowed email addresses other than Mindtree

                    Case "infraedge.com"

                  

                    'Mindtree email IDs

                    Case "mindtree.com"

                      If InStr(strRecepient, "gsmc") > 0 Then

                        'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                        If StrComp(strRecepient, INFRAHEDGE_Email) <> 0 Then  'gsmc.infrahedge2@mindtree.com

                           flagWarn = True

                        End If

                       End If

                    'Allow all non Mindtree IDs

                     Case Else

                           flagWarn = True

           

                End Select

              

          Next

       

        'Second email account ( gsmc.servicedesk@mindtree.com )

        Case GSMCSERVICEDESK_Email     'gsmc.servicedesk@mindtree.com


     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                    'allowed email addresses

                    Case "suterra.com"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, GSMCSERVICEDESK_Email) <> 0 Then  'gsmc.infrahedge2@mindtree.com

                                flagWarn = True

                            End If

                        End If

                    'Allow all non Mindtree IDs

                    Case Else

                        flagWarn = True

           

                End Select

              

    

          Next

         

        'Third email account    ( MacArthur.GSMC@mindtree.com )

        Case MACARTHUR_Email     'MacArthur.GSMC@mindtree.com


     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                    

                    'allowed email addresses

                    Case "macfound.org"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, MACARTHUR_Email) <> 0 Then  'gsmc.infrahedge2@mindtree.com

                                flagWarn = True

                            End If

                        End If

                     'Allow all non Mindtree IDs

                    Case Else

                        flagWarn = True

           

                End Select

              

            Next

       

        'Fourth email account ( gsmc.fordfoundation@mindtree.com )

        Case FORDFOUNDATION_Email  'gsmc.fordfoundation@mindtree.com

       
       '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                    Case "fordfoundation.org"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, FORDFOUNDATION_Email) <> 0 Then  'gsmc.infrahedge2@mindtree.com

                                flagWarn = True

                            End If

                        End If

             

                    Case Else

                        flagWarn = True

               

                End Select

              

    

            Next

         

        'Fifth email account ( gsmc.mscdirect@mindtree.com )

        Case GSMCMSCDIRECT_Email     'gsmc.mscdirect@mindtree.com


       '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                    Case "mscdirect.com"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, GSMCMSCDIRECT_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                                       

                    Case Else

                        flagWarn = True

           

                End Select

   

           Next

         

        'Sixth email account   ( psic.gsmc@mindtree.com )

        Case PSIC_Email     'psic.gsmc@mindtree.com

       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                    Case "pacificspecialty.com"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, PSIC_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                       

                    Case Else

                        flagWarn = True

                       

                End Select

              

    

          Next

      

        'Seveth email account     ( gsmc.bissell@mindtree.com )

           Case BISSELL_Email     'gsmc.bissell@mindtree.com

       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                    Case "bissell.com"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, BISSELL_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                       

                    Case Else

                        flagWarn = True

                       

                End Select

              

    

            Next

       

        

        'Eighth email account ( gsmc.realogy@mindtree.com )

        Case REALOGY_Email    'gsmc.realogy@mindtree.com
       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                   

                    'allowed email addresses

                    Case "realogy.com"

                       

                    Case "mindtree.com"

                       If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, REALOGY_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                               

                    Case Else

                        flagWarn = True

               

                End Select

             

    

          Next

         

        'Ningth email account (husqvarna.gsmc@mindtree.com)

        Case HUSQVARNA_Email    'husqvarna.gsmc@mindtree.com

       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                   

                    'allowed email addresses

                     Case "husqvarna.com"

                
                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, HUSQVARNA_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                    

                    Case Else

                        flagWarn = True

               

                End Select

        

           Next

         

        'Tenth email account   ( gsmc.cap@mindtree.com )

        Case GSMCCAP_Email     'gsmc.cap@mindtree.com

       

     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       
          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                   

                    'allowed email addresses

                   
                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, GSMCCAP_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

             

                    Case Else

                        flagWarn = True

           

                End Select

          Next
     
    



'ELEVENTH email account (gsmc.nordex@mindtree.com)

        Case GSMCNORDEX_Email    'gsmc.nordex@mindtree.com

      
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
        

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

                   

                    'allowed email addresses

                    Case "nordex-online.com"

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, GSMCNORDEX_Email) <> 0 Then

                                flagWarn = True

                            End If

                        End If

                    

                    Case Else

                        flagWarn = True

               

                End Select
                
                
                
                Next
                
                
                 
  'TWELVETH email account ( gsmc.tcg@mindtree.com )

               Case GSMCTCG_Email  'gsmc.tcg@mindtree.com

       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

                   For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

           

            

                Select Case LCase(Right(strRecepient, iLen))

           

                

                       

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, GSMCTCG_Email) <> 0 Then  'gsmc.infrahedge2@mindtree.com

                                flagWarn = True

                            End If

                        End If

             

                    Case Else

                        flagWarn = True

               

                End Select
                
                
                Next
                
 
    
    'THIRNTEENTH email account (gunnebo.gsmc@mindtree.com )

        
        Case Gunnebo_Email 'gunnebo.gsmc@mindtree.com

       
     '----------------25-Sep-2019----------------
               
            stremailBody = Item.Body
            If InStr(stremailBody, LCase(account.SmtpAddress)) = 0 Then
        
                responseInt1 = MsgBox("Email signature has different emailID from " & account.SmtpAddress & " . Please change the email signature", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")
                If responseInt1 = vbNo Or responseInt1 = vbYes Then
                    Cancel = True
                End If
                Exit Sub
            End If
                
     '----------------25-Sep-2019----------------
       

          For Each emailRecepient In emailRecepients

   

                Set propAccess = emailRecepient.PropertyAccessor

                strRecepient = LCase(propAccess.GetProperty(PR_SMTP_ADDRESS))

                iLen = Len(strRecepient) - InStrRev(strRecepient, "@")

       
            

                Select Case LCase(Right(strRecepient, iLen))

                                 

                    Case "mindtree.com"

                        If InStr(strRecepient, "gsmc") > 0 Then

                            'For all gsmc* mindtree domain email IDs, allow only gsmc.infrahedge2@mindtree.com

                            If StrComp(strRecepient, Gunnebo_Email) <> 0 Then 'gsmc.infrahedge2@mindtree.com

                                flagWarn = True

                            End If

                        End If

             

                    Case Else

                        flagWarn = True

            End Select
            
            
            
            Next
            
            
       End Select

    If flagWarn = True Then

        If MsgBox("This email is being sent from " & account.SmtpAddress & " . Do you still wish to send?", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox") = vbNo Then

            Cancel = True

        End If

    End If



'-----------------------------****-----------------------------****-----------------------------


 

Dim responseInt As Integer

     'If StrComp(LCase(Item.SendUsingAccount.DisplayName), LCase(account.SmtpAddress)) <> 0 Then

       If InStr(LCase(Item.SendUsingAccount.DisplayName), LCase(account.SmtpAddress)) = 0 Then


        responseInt = MsgBox("This email is being sent from " & account.SmtpAddress & " . Please change the emailbox", vbYesNo + vbExclamation + vbMsgBoxSetForeground, "Check Mailbox")

        If responseInt = vbNo Or responseInt = vbYes Then

            Cancel = True

         End If

     End If

    
    
End Sub


Function GetAccountForFolder(folder) As Outlook.account

               'Obtain the store on which the folder resides.
               Dim store As Outlook.store
               Dim acct As Outlook.account
    
               Set store = folder.store
     
               For Each acct In Application.Session.Accounts
               If (acct.DeliveryStore.StoreID = store.StoreID) Then
               Set GetAccountForFolder = acct
               End If
          
               Next
      
End Function


